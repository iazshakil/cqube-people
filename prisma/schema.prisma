// CQube People - Enterprise HR Management System
// Comprehensive 360-degree HR Solution

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ==================== CORE MODELS ====================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  role          String    @default("employee") // admin, hr, manager, employee
  avatar        String?
  phone         String?
  departmentId  String?
  department    Department?  @relation(fields: [departmentId], references: [id])
  employee      Employee?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Department {
  id          String     @id @default(cuid())
  name        String
  description String?
  managerId   String?    @unique
  manager     Employee?  @relation("DepartmentManager", fields: [managerId], references: [id])
  employees   Employee[] @relation("DepartmentEmployees")
  users       User[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Employee {
  id              String      @id @default(cuid())
  employeeId      String      @unique
  firstName       String
  lastName        String
  email           String      @unique
  phone           String?
  avatar          String?
  dateOfBirth     DateTime?
  gender          String?     // male, female, other
  maritalStatus   String?     // single, married, divorced, widowed
  nationality     String?
  address         String?
  city            String?
  state           String?
  country         String?
  postalCode      String?
  
  // Employment Details
  departmentId    String?
  department      Department?  @relation("DepartmentEmployees", fields: [departmentId], references: [id])
  designation     String?
  employmentType  String      @default("full-time") // full-time, part-time, contract, intern
  joinDate        DateTime
  endDate         DateTime?
  status          String      @default("active") // active, on_leave, terminated, resigned
  salary          Float?
  bankName        String?
  bankAccount     String?
  taxId           String?
  
  // Reporting
  reportingTo     String?
  manager         Employee?   @relation("EmployeeManager", fields: [reportingTo], references: [id])
  subordinates    Employee[]  @relation("EmployeeManager")
  
  // Managed Department
  managedDepartment Department? @relation("DepartmentManager")
  
  // Relations
  user            User?       @relation(fields: [userId], references: [id])
  userId          String?     @unique
  attendance      Attendance[]
  leaveRequests   LeaveRequest[]
  leaveBalances   LeaveBalance[]
  payrolls        Payroll[]
  performanceReviews PerformanceReview[]
  goals           Goal[]
  trainings       TrainingRecord[]
  documents       Document[]
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

// ==================== ATTENDANCE & LEAVE ====================

model Attendance {
  id          String    @id @default(cuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  date        DateTime
  checkIn     DateTime?
  checkOut    DateTime?
  workHours   Float?
  status      String    @default("present") // present, absent, late, half_day, holiday
  notes       String?
  location    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@unique([employeeId, date])
}

model LeaveType {
  id          String        @id @default(cuid())
  name        String
  code        String        @unique
  description String?
  daysAllowed Int
  isPaid      Boolean       @default(true)
  leaveBalances LeaveBalance[]
  leaveRequests  LeaveRequest[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model LeaveBalance {
  id          String    @id @default(cuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  leaveTypeId String
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])
  year        Int
  balance     Float
  used        Float     @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@unique([employeeId, leaveTypeId, year])
}

model LeaveRequest {
  id          String    @id @default(cuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  leaveTypeId String
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])
  startDate   DateTime
  endDate     DateTime
  days        Float
  reason      String?
  status      String    @default("pending") // pending, approved, rejected, cancelled
  approvedBy  String?
  approvedAt  DateTime?
  rejectionReason String?
  attachments String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ==================== RECRUITMENT ====================

model JobPosting {
  id              String      @id @default(cuid())
  title           String
  code            String      @unique
  department      String?
  location        String?
  type            String?     // full-time, part-time, contract
  experience      String?
  salary          String?
  description     String
  requirements    String?
  benefits        String?
  status          String      @default("draft") // draft, published, closed, archived
  postedDate      DateTime?
  closingDate     DateTime?
  applications    Application[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Application {
  id              String      @id @default(cuid())
  jobPostingId    String
  jobPosting      JobPosting  @relation(fields: [jobPostingId], references: [id])
  firstName       String
  lastName        String
  email           String
  phone           String?
  resume          String?
  coverLetter     String?
  portfolio       String?
  linkedIn        String?
  currentCompany  String?
  experience      String?
  expectedSalary  String?
  noticePeriod    String?
  status          String      @default("applied") // applied, screening, interview, offered, hired, rejected
  stage           String?
  rating          Int?
  notes           String?
  interviews      Interview[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Interview {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  type          String      // phone, video, onsite, technical
  scheduledAt   DateTime
  duration      Int         // in minutes
  interviewer   String?
  location      String?
  meetingLink   String?
  status        String      @default("scheduled") // scheduled, completed, cancelled, no_show
  notes         String?
  feedback      String?
  rating        Int?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// ==================== PAYROLL ====================

model Payroll {
  id              String    @id @default(cuid())
  employeeId      String
  employee        Employee  @relation(fields: [employeeId], references: [id])
  month           Int
  year            Int
  basicSalary     Float
  allowances      Float     @default(0)
  overtime        Float     @default(0)
  bonus           Float     @default(0)
  deductions      Float     @default(0)
  tax             Float     @default(0)
  netSalary       Float
  status          String    @default("pending") // pending, processed, paid
  paidDate        DateTime?
  paymentMethod   String?
  paySlip         String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@unique([employeeId, month, year])
}

// ==================== PERFORMANCE ====================

model PerformanceReview {
  id              String    @id @default(cuid())
  employeeId      String
  employee        Employee  @relation(fields: [employeeId], references: [id])
  reviewerId      String?
  reviewPeriod    String
  reviewDate      DateTime
  overallRating   Float?
  strengths       String?
  improvements    String?
  goals           String?
  comments        String?
  status          String    @default("pending") // pending, completed
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Goal {
  id              String    @id @default(cuid())
  employeeId      String
  employee        Employee  @relation(fields: [employeeId], references: [id])
  title           String
  description     String?
  category        String?
  startDate       DateTime
  dueDate         DateTime
  progress        Int       @default(0)
  status          String    @default("not_started") // not_started, in_progress, completed, cancelled
  priority        String    @default("medium") // low, medium, high
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// ==================== TRAINING ====================

model Training {
  id              String          @id @default(cuid())
  title           String
  description     String?
  category        String?
  instructor      String?
  duration        Int             // in hours
  type            String?         // online, offline, self-paced
  cost            Float?
  startDate       DateTime?
  endDate         DateTime?
  maxParticipants Int?
  status          String          @default("upcoming") // upcoming, ongoing, completed, cancelled
  records         TrainingRecord[]
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model TrainingRecord {
  id          String    @id @default(cuid())
  trainingId  String
  training    Training  @relation(fields: [trainingId], references: [id])
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  status      String    @default("enrolled") // enrolled, in_progress, completed, dropped
  progress    Int       @default(0)
  score       Float?
  certificate String?
  enrolledAt  DateTime  @default(now())
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@unique([trainingId, employeeId])
}

// ==================== DOCUMENTS ====================

model Document {
  id          String    @id @default(cuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  name        String
  type        String    // contract, id_proof, certificate, other
  fileUrl     String
  fileSize    Int?
  uploadedAt  DateTime  @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ==================== SETTINGS ====================

model CompanySettings {
  id          String    @id @default(cuid())
  companyName String
  logo        String?
  address     String?
  phone       String?
  email       String?
  website     String?
  workingDays String?   // JSON array of working days
  workingHours String?
  fiscalYear  String?
  currency    String    @default("USD")
  timezone    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Holiday {
  id          String    @id @default(cuid())
  name        String
  date        DateTime
  type        String    @default("public") // public, optional, company
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Announcement {
  id          String    @id @default(cuid())
  title       String
  content     String
  priority    String    @default("normal") // low, normal, high
  target      String    @default("all") // all, department, specific
  status      String    @default("draft") // draft, published, archived
  publishDate DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
